<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wine Shop</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <h1>Welcome to the Wine Shop</h1>

    <!-- View Cart Button placed at the top and visible initially -->
    <a id="view-cart" href="/panier">ðŸ›’ View Cart</a>

    <div id="wine-list"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetchWines();
            setupCartButton();
        });

        // Fetch wine data from the server and display it
        function fetchWines() {
            fetch("/wines")
                .then(response => response.json())
                .then(wines => displayWines(wines))
                .catch(error => console.error("Error loading wines:", error));
        }

        // Display wines on the page
        function displayWines(wines) {
            const wineList = document.getElementById("wine-list");
            wineList.innerHTML = ""; // Clear previous content

            wines.forEach(wine => {
                const wineCard = document.createElement("div");
                wineCard.className = "wine-card";
                wineCard.innerHTML = `
                    <h3>${wine.title}</h3>
                    <p><strong>Variety:</strong> ${wine.variety}</p>
                    <p><strong>Region:</strong> ${wine.region_1}</p>
                    <p><strong>Winery:</strong> ${wine.winery}</p>
                    <p><strong>Price:</strong> $${wine.price.toFixed(2)}</p>
                    <button onclick="addToCart(${JSON.stringify(wine).replace(/"/g, '&quot;')})">Add to Cart</button>
                `;
                wineList.appendChild(wineCard);
            });
        }

        // Add item to cart
        function addToCart(wine) {
            fetch("/add-to-cart", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(wine)
            })
            .then(response => {
                if (response.ok) {
                    alert("Added to cart!");
                    updateViewCartButton();
                } else {
                    alert("Failed to add item.");
                }
            })
            .catch(error => console.error("Error adding to cart:", error));
        }

        // Redirect to cart page
        function setupCartButton() {
            document.getElementById("view-cart").addEventListener("click", function () {
                window.location.href = "/panier";
            });
        }

        // Show the "View Cart" button after adding an item
        function updateViewCartButton() {
            let button = document.getElementById("view-cart");
            // If needed, you can hide or show the button depending on cart content
            // e.g., hide if cart is empty, show if there are items in the cart
        }
    </script>
</body>
</html>
